<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="方向"><title>iOS自动化实践——WebDriverAgent(五) | 自动化测试</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS自动化实践——WebDriverAgent(五)</h1><a id="logo" href="/.">自动化测试</a><p class="description">不二家的小球童的测试之路</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iOS自动化实践——WebDriverAgent(五)</h1><div class="post-meta">Aug 2, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>这两天开始真正开始根据用例写自动化测试脚本，但是遇到了一个问题，特别是当遇到inspector展示的页面控件元素为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Class:</div><div class="line">Image</div><div class="line">Raw identifier:</div><div class="line">run_history_arrow</div><div class="line">Name:</div><div class="line">run_history_arrow</div><div class="line">Rect:</div><div class="line">&#123;&#123;206.5, 238.5&#125;, &#123;16, 16&#125;&#125;</div><div class="line">isEnabled:</div><div class="line">Yes</div><div class="line">isVisible:</div><div class="line">No</div></pre></td></tr></table></figure></p>
<p>总是发现使用，自己封装的<code>find_name(text=name,className=classname)</code>找不到控件，为解决这个问题，我感觉自己走了个乌龙，但是我还是记述一下，当做对自己的警醒吧。</p>
<h4 id="现象是：当控件元素为isVisible-NO时候，无法定位？"><a href="#现象是：当控件元素为isVisible-NO时候，无法定位？" class="headerlink" title="现象是：当控件元素为isVisible=NO时候，无法定位？"></a>现象是：当控件元素为isVisible=NO时候，无法定位？</h4><h4 id="思路一：使用类似于appium中的TouchAction实现。"><a href="#思路一：使用类似于appium中的TouchAction实现。" class="headerlink" title="思路一：使用类似于appium中的TouchAction实现。"></a>思路一：使用类似于appium中的TouchAction实现。</h4><p>1、因为在appium使用过程中，同样的控件，使用<br><code>driver.find_name(&#39;run_history_arrow&#39;).click()</code>是没有效果的，当时是使用类似于<br><code>TouchAction(driver).press(driver.find_name(&#39;run_history_arrow&#39;)).perform()</code><br>实现，因而第一思路是通过方法<code>touch action</code>实现。<br>可是<code>WDA</code>内又没有这样的api，该怎么办呢？<br>想到<code>macaca</code>封装的是<code>WDA</code>，去参考一下<code>macaca</code>是怎么实现的就可以了。<br>由于之前配置过<code>macaca</code>的环境，具体环境配置可见<a href="https://macacajs.github.io/macaca/" target="_blank" rel="external">macaca官方链接</a>。<br>调出<code>macaca</code>的执行用例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">it(&apos;#1 test&apos;, function() &#123;</div><div class="line"> return driver</div><div class="line">   .sleep(1000)</div><div class="line">   .waitForElementByName(&apos;发现&apos;)</div><div class="line">   .click()</div><div class="line">   .sleep(1000)</div><div class="line">   .performTouchAction(wd.TouchAction.press(</div><div class="line">     driver.waitForElementByName(&apos;智玩&apos;)))</div><div class="line">   .sleep(5000);</div><div class="line"> &#125;);</div></pre></td></tr></table></figure></p>
<p>发现怎么都执行不成功，也无法查看发起的请求是什么？后来联系了达峰，他告诉我，服务端暂时未实现<br><code>touch action</code>的功能，只能通过在<code>macaca</code>内的代码里大致看到请求格式为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Post /session/sessionid/touch/perform</div></pre></td></tr></table></figure></p>
<p>2、既然<code>macaca</code>走不通，就去查看appium的源码，因为<code>appium</code>也封装了<code>touch action</code>，我知道<br><code>appium</code>是完全可执行成功的。<br>在<code>appium</code>内<code>_request</code>打断点，<code>print request</code>等等，终于可以捞出了完全的请求格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl -X POST -H &quot;Content-Type: application/json&quot; -d &quot;&#123;&quot;actions&quot;: [&#123;&quot;action&quot;:</div><div class="line"> &quot;press&quot;, &quot;elementId&quot;: &quot;4B72992B-0B42-4A14-9127-06F217CAA5DB&quot;&#125;]&#125;&quot; </div><div class="line"> http://192.168.1.101:8100/session/C8C847CF-AD3D-4F5F-B51B-EA67788875DE/touch/</div><div class="line"> perform</div></pre></td></tr></table></figure></p>
<p>可是奇怪的是，仍然没有起到任何效果，而且获取的返回值<code>status=1</code>显然是一个错误的请求。</p>
<h4 id="思路二：观察inspector展示的isVisible-NO，思考是否跟此有关？"><a href="#思路二：观察inspector展示的isVisible-NO，思考是否跟此有关？" class="headerlink" title="思路二：观察inspector展示的isVisible=NO，思考是否跟此有关？"></a>思路二：观察inspector展示的<code>isVisible=NO</code>，思考是否跟此有关？</h4><p>1、看到<code>isVisible=NO</code>的都无法定位，但是只要是<code>isVisible=YES</code>的却都可以点击触发。<br>所以尝试通过<code>xcode</code>更改<code>isVisible=NO</code>的属性，查看了大量的链接和咨询了开发，无法给出定论说如何更改此属性，我显示有点儿灰心。。。。<br>2、尝试通过自己发起请求来定位此控件，发现竟然有返回值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;value&quot; : [</div><div class="line">    &#123;</div><div class="line">      &quot;ELEMENT&quot; : &quot;0BCEDAB9-66DE-413B-B78D-4AF15C67476A&quot;,</div><div class="line">      &quot;type&quot; : &quot;XCUIElementTypeImage&quot;,</div><div class="line">      &quot;label&quot; : null</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;sessionId&quot; : &quot;8BFE332C-4954-4F5C-BAAA-330DCD49E61E&quot;,</div><div class="line">  &quot;status&quot; : 0</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个时候才注意到，label值为空，突然联想到之前封装的<code>client</code>端有一句代码是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if self._text and elem.get(&apos;label&apos;) != self._text:        </div><div class="line">     continue</div></pre></td></tr></table></figure></p>
<p>我立马恍然，原来是自己走了弯路，封装错了。</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>其实很简单，只是注销这一句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if self._text and elem.get(&apos;label&apos;) != self._text:        </div><div class="line">     continue</div></pre></td></tr></table></figure></p>
<p>程序可以执行成功。<br>好吧，我浪费了将近两天的时间，功能自动化测试继续。。。。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/08/02/iOS自动化实践——WebDriverAgent-五/" data-id="civjf6pk1000bqsgqhor5najx" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/08/03/iOS自动化实践——WebDriverAgent-六/" class="pre">iOS自动化实践——WebDriverAgent(六)</a><a href="/2016/07/29/iOS自动化实践——WebDriverAgent-四/" class="next">iOS自动化实践——WebDriverAgent(四)</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/15/持续集成实施-九/">持续集成实施(九)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/04/持续集成实施-八/">持续集成实施(八)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/21/持续集成实施-七/">持续集成实施(七)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/18/持续集成实施-六/">持续集成实施(六)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/持续集成实施-五/">持续集成实施(五)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/09/持续集成实施-四/">持续集成实施(四)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/08/持续集成实施-三/">持续集成实施(三)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/27/持续集成实施-二/">持续集成实施(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/23/持续集成实施-一/">持续集成实施(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/20/Charles抓包指南/">Charles抓包指南</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/diaojunxian/ios_testing" title="Python封装——TuneupJs" target="_blank">Python封装——TuneupJs</a><ul></ul><a href="https://testerhome.com/" title="Testerhome" target="_blank">Testerhome</a><ul></ul><a href="http://www.v2ex.com/" title="V2EX" target="_blank">V2EX</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">自动化测试.</a> Powered by<a rel="nofollow" target="_blank"> DJX.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?true";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>