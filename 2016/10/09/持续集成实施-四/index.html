<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="方向"><title>持续集成实施(四) | 自动化测试</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">持续集成实施(四)</h1><a id="logo" href="/.">自动化测试</a><p class="description">不二家的小球童的测试之路</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">持续集成实施(四)</h1><div class="post-meta">Oct 9, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>本篇介绍有关jenkins项目依赖的插件parameterized trigger plugin等。<br>先表明我们的需求是需要使用git parameter，这个插件的好处是可以在参数化构建前，将项目所<br>有分支同步过来然后选择分支构建，方便进行版本控制。</p>
<hr>
<h3 id="一、git-parameter使用"><a href="#一、git-parameter使用" class="headerlink" title="一、git parameter使用"></a>一、git parameter使用</h3><p>git parameter在github上地址：<a href="https://github.com/jenkinsci/git-parameter-plugin" target="_blank" rel="external">https://github.com/jenkinsci/git-parameter-plugin</a><br>在jenkins上安装插件以后，选择参数化构建就可以使用。<br>需要注意的是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1、Parameter Type==》Branch 或者 Tag等，目前使用Branch</div><div class="line">2、Branch Fiter==》正则匹配，可以过滤掉不希望显示的分支，</div><div class="line">3、目前为了过滤sandbox，使用表达式^((?!(sandbox)).)*$</div></pre></td></tr></table></figure></p>
<p>在使用git parameter之后，遇到了一个坑，因为在打iOS的包的时候，使用了Multiple SCMs来<br>拉取代码的，发现在使用过程中遇到，选择Build with Parameters时候，Branch出现报错提示为：<br><code>!No Git respository configured in SCM configuration</code>，原来git parameter这个插件不能支持Multiple SCMs，已经提了issue，开源作者貌似没动静。</p>
<h3 id="二、parameterized-trigger-plugin使用"><a href="#二、parameterized-trigger-plugin使用" class="headerlink" title="二、parameterized trigger plugin使用"></a>二、parameterized trigger plugin使用</h3><p>parameterized trigger plugin可以用来传递不同job一个文件名或者路径，这个时候我们不需要传递文件实体，那这个路径如何传递呢？比如有如下两个项目，我想把A的工作目录传递给B，让B使用。 操作流程分为两步：<br>1、在Ajob内的操作：</p>
<hr>
<p><img src="https://raw.githubusercontent.com/diaojunxian/diaojunxian.github.io/master/images/parameterA.png" alt="A项目中配置"><br>如图所示：我将A项目的工作目录传递给了自定义参数TEST_WORKSPACE.到这里A项目的配置就完成了。<br>2、在Bjob内配置：</p>
<hr>
<p><img src="https://raw.githubusercontent.com/diaojunxian/diaojunxian.github.io/master/images/parameterB.png" alt="B项目中配置"><br>我们在A项目配置的TEST_WORKSPACE参数，如果在B job中使用，首先我们在配置界面中，勾选The build is parameterized。这样我们就在当前工作环境中得到了由A传递过来的参数。</p>
<h3 id="三、Multijob-Plugin插件"><a href="#三、Multijob-Plugin插件" class="headerlink" title="三、Multijob Plugin插件"></a>三、Multijob Plugin插件</h3><p>这是一个集成了ParameterizedTrigger和BuildPipeline的插件，但它是形成一个新的job，而不是一个视图。并且它不要求job之间本身就存在依赖关系。这样一来，建立job的时候可以保持相对的独立性，而通过这个插件来组装成产品所需要的持续集成环境。<br>需要注意的是：在创建job时一定要选择“MultiJob Project”，在“free-style project”下默认<br>是不能选择使用这个插件的。<br>如图所示我集成了Multijob之后，新建了两个下游项目。</p>
<hr>
<p><img src="https://raw.githubusercontent.com/diaojunxian/diaojunxian.github.io/master/images/Mutijob1.png" alt="Multijob展示"><br>配置如下：</p>
<hr>
<p><img src="https://raw.githubusercontent.com/diaojunxian/diaojunxian.github.io/master/images/Mutijob2.png" alt="Multijob配置两个job"></p>
<p>需要在两个下游job中配置一下参数，就能引用Multijob中的参数：</p>
<hr>
<p><img src="https://raw.githubusercontent.com/diaojunxian/diaojunxian.github.io/master/images/Mutijob3.png" alt="job配置两个job"></p>
<h3 id="四、Join-Plugin插件"><a href="#四、Join-Plugin插件" class="headerlink" title="四、Join Plugin插件"></a>四、Join Plugin插件</h3><p>这也是一个触发job的插件，亮点在于它触发job的条件是等待所有当前job的下游的job都完成才会发生。当然，只有在当前job有两个及以上的下游job时才有意义。简单举个例子来说，A同时触发B1和B2两个job，然后配置这个插件又触发C，这时C就会等B1和B2都完成之后才会被执行。<br>需要注意的是：默认情况下，通过Join插件触发的job是不能传递参数的，如果有需要，可以勾选“Trigger parameterized build on other project”，这样其实就是把Join插件和<br>ParameterizedTrigger插件集成起来了。</p>
<hr>
<p><img src="https://raw.githubusercontent.com/diaojunxian/diaojunxian.github.io/master/images/join1.png" alt="Join配置job"><br>当然同样需要在下游job中配置一下参数化构建，才能引用Join中的传递的参数。</p>
<h3 id="五、命令行直接git-clone代码"><a href="#五、命令行直接git-clone代码" class="headerlink" title="五、命令行直接git clone代码"></a>五、命令行直接git clone代码</h3><p>最后发现，这些插件都不能满足项目要求，最后无奈只能选用命令行git clone代码的方法，可以通过ssh(key file)或者https(.netrc)，当然我们的项目代码都是ssh，所以直接git clone ssh://xxx即可，当然，<br>需要在构建环境中选择SSH Agent确认Credentials。</p>
<hr>
<p>简单记述，以便整理。。。。。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/10/09/持续集成实施-四/" data-id="ciw1q9clp000sphgqbg8wrr5o" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/10/10/持续集成实施-五/" class="pre">持续集成实施(五)</a><a href="/2016/10/08/持续集成实施-三/" class="next">持续集成实施(三)</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/28/持续集成实施-十一-——新需求/">持续集成实施(十一)——新需求</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/持续集成实施-——Oclint/">持续集成实施(十)——Oclint</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/15/持续集成实施-九/">持续集成实施(九)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/04/持续集成实施-八/">持续集成实施(八)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/21/持续集成实施-七/">持续集成实施(七)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/18/持续集成实施-六/">持续集成实施(六)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/持续集成实施-五/">持续集成实施(五)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/09/持续集成实施-四/">持续集成实施(四)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/08/持续集成实施-三/">持续集成实施(三)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/27/持续集成实施-二/">持续集成实施(二)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/diaojunxian/ios_testing" title="Python封装——TuneupJs" target="_blank">Python封装——TuneupJs</a><ul></ul><a href="https://testerhome.com/" title="Testerhome" target="_blank">Testerhome</a><ul></ul><a href="http://www.v2ex.com/" title="V2EX" target="_blank">V2EX</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">自动化测试.</a> Powered by<a rel="nofollow" target="_blank"> DJX.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?true";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>